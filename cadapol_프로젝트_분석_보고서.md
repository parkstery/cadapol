# Cadapol 프로젝트 분석 보고서

**작성일**: 2026년 1월 18일  
**프로젝트명**: Cadapol (Advanced Dual Map Viewer)  
**버전**: 1.0  
**상태**: 활성 개발 중

---

## 목차

1. [프로젝트 개요](#1-프로젝트-개요)
2. [기술 스택](#2-기술-스택)
3. [프로젝트 구조](#3-프로젝트-구조)
4. [주요 기능 분석](#4-주요-기능-분석)
5. [컴포넌트 상세 분석](#5-컴포넌트-상세-분석)
6. [기술적 특징 및 아키텍처](#6-기술적-특징-및-아키텍처)
7. [해결한 주요 문제들](#7-해결한-주요-문제들)
8. [성능 및 최적화](#8-성능-및-최적화)
9. [보안 고려사항](#9-보안-고려사항)
10. [개선 사항 및 향후 계획](#10-개선-사항-및-향후-계획)
11. [결론](#11-결론)

---

## 1. 프로젝트 개요

### 1.1 프로젝트 목적

Cadapol은 **고급 이중 지도 뷰어(Advanced Dual Map Viewer)**로, Google Maps, Kakao Maps, Naver Maps 등 여러 지도 서비스를 통합하여 좌우 두 개의 패널에서 동시에 비교하고 동기화할 수 있는 GIS(지리정보시스템) 웹 애플리케이션입니다.

### 1.2 핵심 가치

- **다중 지도 서비스 통합**: 하나의 인터페이스에서 여러 지도 제공자 비교
- **실시간 동기화**: 위치, 줌 레벨, 거리뷰 상태를 실시간으로 동기화
- **고급 GIS 기능**: 거리 측정, 면적 측정, 지적 경계 조회 등 전문 도구 제공
- **사용자 친화적 UI**: 직관적인 인터페이스와 부드러운 애니메이션

### 1.3 주요 사용 사례

- 부동산 및 토지 조사
- 지도 데이터 비교 및 검증
- 위치 기반 정보 분석
- GIS 전문가 도구

---

## 2. 기술 스택

### 2.1 프론트엔드 프레임워크

| 기술 | 버전 | 용도 |
|------|------|------|
| React | 19.2.3 | UI 프레임워크 |
| React DOM | 19.2.3 | React DOM 렌더링 |
| TypeScript | 5.8.2 | 타입 안정성 |
| Vite | 6.2.0 | 빌드 도구 및 개발 서버 |

### 2.2 외부 API 및 SDK

| 서비스 | 용도 | 주요 기능 |
|--------|------|-----------|
| Google Maps API | 지도 표시 | Street View, 위성 이미지 |
| Kakao Maps API | 지도 표시, 검색 | 로드뷰, Places 검색, GIS 도구 |
| Naver Maps API | 지도 표시 | 거리뷰(파노라마), 위성 이미지 |
| VWorld API | 지적 정보 | 지적 경계 폴리곤 조회 |

### 2.3 라이브러리 및 도구

| 패키지 | 버전 | 용도 |
|--------|------|------|
| proj4 | ^2.9.0 | 좌표계 변환 (EPSG:5179 → EPSG:4326) |
| @vitejs/plugin-react | ^5.0.0 | Vite React 플러그인 |
| Tailwind CSS | CDN | 유틸리티 기반 CSS 프레임워크 |

### 2.4 개발 도구

- **Node.js**: 런타임 환경
- **npm**: 패키지 매니저
- **TypeScript**: 정적 타입 검사
- **Vite**: 빠른 개발 서버 및 빌드

---

## 3. 프로젝트 구조

```
cadapol/
├── App.tsx                      # 메인 애플리케이션 컴포넌트
├── index.tsx                    # React 앱 진입점
├── index.html                   # HTML 템플릿 (SDK 로드 포함)
├── types.ts                     # TypeScript 타입 정의
├── vite.config.ts               # Vite 설정
├── tsconfig.json                # TypeScript 설정
├── package.json                 # 프로젝트 의존성
├── vercel.json                  # Vercel 배포 설정
├── components/
│   ├── Header.tsx               # 상단 헤더 (검색, 맵 선택)
│   ├── MapPane.tsx              # 맵 표시 컴포넌트 (핵심)
│   ├── KakaoGisToolbar.tsx      # 카카오맵 GIS 도구 모음
│   └── FileUpload.tsx           # 파일 업로드 컴포넌트 (향후 사용)
├── public/
│   └── streetview-icon.png      # 거리뷰 아이콘
└── [보고서 파일들]
    ├── 개발보고서.md
    ├── 2026-01-18-1300_중간보고서.md
    └── ...
```

### 3.1 파일 역할

- **App.tsx**: 전역 상태 관리 및 컴포넌트 조율
- **MapPane.tsx**: 개별 맵 렌더링 및 상호작용 (약 2,240줄, 가장 복잡한 컴포넌트)
- **Header.tsx**: 사용자 입력 인터페이스 (검색, 설정)
- **KakaoGisToolbar.tsx**: 카카오맵 전용 GIS 도구 UI
- **types.ts**: 공통 타입 정의

---

## 4. 주요 기능 분석

### 4.1 이중 맵 동기화

**기능 설명**: 좌우 두 개의 맵 패널에서 위치, 줌 레벨을 실시간으로 동기화합니다.

**구현 방식**:
- 전역 상태(`globalState`)로 위치/줌 관리
- 각 맵의 `center_changed`, `zoom_changed` 이벤트 감지
- `isProgrammaticUpdate` 플래그로 무한 루프 방지
- 카카오맵의 경우 줌 레벨 변환 함수 사용 (1-14 ↔ 3-20)

**기술적 특징**:
- React `useCallback`으로 성능 최적화
- 이벤트 리스너 중복 방지 메커니즘
- 상태 업데이트 디바운싱

### 4.2 다중 맵 제공자 지원

**지원 맵 제공자**:

1. **Google Maps**
   - 위성/일반 지도 모드
   - Street View (Pegman 컨트롤)
   - Coverage Layer (거리뷰 가능 영역 표시)

2. **Kakao Maps**
   - 위성/일반 지도 모드
   - 로드뷰 (Roadview)
   - GIS 도구 (거리/면적 측정, 지적도)
   - 지적 경계 폴리곤 조회 (VWorld API 연동)

3. **Naver Maps**
   - 위성/일반 지도 모드
   - 거리뷰 (Panorama)
   - Street Layer (거리뷰 가능 영역 표시)

**SDK 로딩 전략**:
- 비동기 로딩 (`async defer`, `autoload=false`)
- 300ms 간격으로 SDK 로드 상태 확인
- 각 맵 제공자별 초기화 함수 분리

### 4.3 거리뷰/로드뷰 기능

**공통 기능**:
- 거리뷰 활성화 시 메인 맵이 미니맵으로 전환 (240×240px, 좌하단)
- 거리뷰 위치와 미니맵 마커 실시간 동기화
- 거리뷰 방향 변경 시 마커 회전 동기화
- 방향 표시 폴리곤 (원뿔형, 반투명 파란색)

**맵 제공자별 구현**:

1. **Google Maps**
   - `StreetViewPanorama` API 사용
   - Pegman 컨트롤로 활성화
   - Coverage Layer로 가능 영역 표시

2. **Kakao Maps**
   - `Roadview` API 사용
   - Walker 오버레이 (공식 이미지 사용)
   - 방향 표시 폴리곤 (원뿔형)

3. **Naver Maps**
   - `Panorama` API 사용
   - 삼각형 마커 (SVG, 빨간색)
   - 방향 표시 폴리곤 (원뿔형)

**기술적 도전 과제**:
- CSS 트랜지션으로 인한 컨테이너 크기 0 이슈 해결
- 미니맵 위치 강제 설정 (MutationObserver 사용)
- 거리뷰 상태 전역 동기화

### 4.4 위치 검색

**기능**:
- Kakao Places API를 통한 실시간 자동완성 검색
- 검색 결과 드롭다운 표시 (최대 10개)
- 최근 검색 기록 저장 (최대 5개, localStorage)
- 검색 결과 선택 시 두 맵 모두 해당 위치로 이동

**구현 세부사항**:
- `keywordSearch` API 사용
- 입력 디바운싱 (실시간 검색)
- 검색 기록 중복 제거 및 최신순 정렬
- 검색 입력 필드 포커스 시 기록 표시

### 4.5 카카오맵 전용 GIS 도구

**지원 모드**:

1. **로드뷰 모드** (`ROADVIEW`)
   - 지도 클릭으로 로드뷰 시작
   - ROADVIEW 오버레이 추가

2. **지적도 오버레이** (`USE_DISTRICT`)
   - 토글 방식으로 활성화/비활성화

3. **거리 측정** (`DISTANCE`)
   - 클릭으로 경로 그리기
   - 실시간 거리 표시 (플로우팅 오버레이)
   - 우클릭으로 측정 종료 및 총 거리 표시
   - Haversine 공식으로 거리 계산

4. **면적 측정** (`AREA`)
   - 클릭으로 영역 그리기
   - 실시간 면적 표시 (플로우팅 오버레이)
   - 우클릭으로 측정 종료 및 총 면적 표시
   - 카카오맵 API의 `getArea()` 메서드 사용

5. **초기화**
   - 모든 그리기 요소 제거
   - 모든 오버레이 제거

### 4.6 지적 경계 폴리곤 조회

**기능**: 카카오맵에서 지도 클릭 시 해당 위치의 지적 경계 폴리곤을 조회하여 표시합니다.

**구현 방식**:
1. **1단계**: 클릭 위치 좌표로 PNU(필지고유번호) 조회 (VWorld API)
2. **2단계**: PNU로 정확한 폴리곤 Geometry 조회
3. **3단계**: 좌표계 변환 (EPSG:5179 → EPSG:4326, proj4 사용)
4. **4단계**: 카카오맵 Polygon으로 그리기

**기술적 특징**:
- JSONP 방식으로 API 호출 (CORS 우회)
- 좌표계 자동 감지 및 변환
- MultiPolygon 지원 (첫 번째 Polygon만 사용)
- 주소 정보 표시 (커스텀 오버레이)

### 4.7 전체화면 모드

**기능**: 좌측 또는 우측 패널을 전체화면으로 확대/축소합니다.

**구현 방식**:
- CSS 클래스 변경으로 패널 표시/숨김
- 300ms 트랜지션 애니메이션
- 전환 후 100ms 지연 후 맵 리사이즈 이벤트 트리거

---

## 5. 컴포넌트 상세 분석

### 5.1 App.tsx - 메인 애플리케이션 컴포넌트

**역할**: 전체 애플리케이션의 상태 관리 및 컴포넌트 조율

**주요 상태**:
```typescript
- globalState: MapState          // 전역 맵 위치/줌
- leftConfig: PaneConfig         // 좌측 패널 설정
- rightConfig: PaneConfig        // 우측 패널 설정
- searchPos: {lat, lng} | null  // 검색 위치
- fullscreenPane: 'left'|'right'|null  // 전체화면 상태
- streetViewState: {lat, lng, active} | null  // 거리뷰 상태
```

**주요 기능**:
- 전역 상태 동기화
- 검색 결과 처리
- 풀스크린 토글
- 거리뷰 상태 전역 관리

**코드 라인 수**: 약 109줄

### 5.2 MapPane.tsx - 맵 표시 컴포넌트

**역할**: 개별 맵 렌더링 및 상호작용 (가장 복잡한 컴포넌트)

**코드 라인 수**: 약 2,240줄

**주요 기능**:

1. **맵 초기화**
   - SDK 로드 감지 (300ms 간격 체크)
   - 맵 제공자별 초기화 함수 분리
   - 맵 타입 설정 (위성/일반)

2. **이벤트 리스너 관리**
   - `center_changed`, `zoom_changed` 이벤트
   - 드래그 시작/종료 이벤트
   - 클릭 이벤트 (주소 조회, 거리뷰 등)

3. **거리뷰 관리**
   - 거리뷰 컨테이너 관리
   - 미니맵 전환 로직
   - 마커/Walker 동기화
   - 방향 표시 폴리곤 관리

4. **GIS 도구 관리**
   - 거리/면적 측정 모드
   - 그리기 요소 관리
   - 오버레이 관리

5. **지적 경계 조회**
   - VWorld API 연동
   - 좌표계 변환
   - 폴리곤 그리기

**기술적 특징**:
- `useRef`로 맵 인스턴스 및 리소스 관리
- `useCallback`으로 함수 메모이제이션
- 복잡한 상태 동기화 로직
- 리소스 정리 메커니즘 (메모리 누수 방지)

### 5.3 Header.tsx - 상단 헤더

**역할**: 사용자 입력 인터페이스 제공

**주요 기능**:
- 위치 검색 (Kakao Places API)
- 검색 자동완성
- 검색 히스토리 관리 (localStorage)
- 좌/우 맵 제공자 선택
- 위성 이미지 모드 토글

**코드 라인 수**: 약 229줄

**기술적 특징**:
- 검색 입력 디바운싱
- 외부 클릭 감지로 드롭다운 닫기
- 검색 기록 중복 제거

### 5.4 KakaoGisToolbar.tsx - GIS 도구 모음

**역할**: 카카오맵 전용 GIS 도구 UI

**버튼 구성**:
1. 로드뷰 버튼
2. 지적도 버튼
3. 거리 재기 버튼
4. 면적 재기 버튼
5. 초기화 버튼

**코드 라인 수**: 약 63줄

**기술적 특징**:
- 거리뷰 활성화 시 위치 조정
- 활성 모드 시각적 표시 (파란색 배경)

### 5.5 FileUpload.tsx - 파일 업로드 컴포넌트

**역할**: 파일 업로드 기능 제공 (향후 사용 예정)

**기능**:
- 드래그 앤 드롭 지원
- 파일 타입/크기 검증
- 에러 메시지 표시

**코드 라인 수**: 약 206줄

---

## 6. 기술적 특징 및 아키텍처

### 6.1 상태 관리 아키텍처

**전역 상태 관리**:
- React `useState`로 전역 상태 관리
- Props drilling 최소화
- 상태 업데이트 콜백 패턴

**상태 동기화 전략**:
```
사용자 액션 → 이벤트 감지 → 상태 업데이트 → 전역 상태 변경 → 
다른 컴포넌트 동기화 → 무한 루프 방지
```

### 6.2 이벤트 처리 아키텍처

**이벤트 리스너 관리**:
- 중복 리스너 방지 메커니즘
- 컴포넌트 언마운트 시 리스너 정리
- 이벤트 위임 패턴

**무한 루프 방지**:
- `isDragging` 플래그
- `isProgrammaticUpdate` 플래그
- 상태 업데이트 조건부 실행

### 6.3 리소스 관리

**메모리 관리**:
- 맵 인스턴스 재사용
- 오버레이 정리 메커니즘
- 이벤트 리스너 정리
- Blob URL 정리 (네이버맵 마커 아이콘)

**리소스 정리 시점**:
- 컴포넌트 언마운트 시
- 맵 제공자 변경 시
- 모드 변경 시

### 6.4 좌표계 변환

**지원 좌표계**:
- EPSG:4326 (WGS84, 위도/경도)
- EPSG:5179 (한국 TM 좌표계)

**변환 라이브러리**: proj4

**사용 사례**:
- VWorld API 지적 경계 폴리곤 좌표 변환

### 6.5 반응형 디자인

**레이아웃 전략**:
- 데스크톱: 좌우 분할 (`flex-row`)
- 모바일: 상하 분할 (`flex-col`)
- 전체화면: 선택된 패널만 표시

**미디어 쿼리**: Tailwind CSS의 `md:` 브레이크포인트 사용

---

## 7. 해결한 주요 문제들

### 7.1 네이버 거리뷰 파노라마 렌더링 문제

**문제**: 거리뷰 활성화 시 파노라마 이미지가 표시되지 않음

**근본 원인**: CSS 트랜지션으로 인한 컨테이너 크기 0px 상태에서 API 초기화 시도

**해결 방안**:
- 컨테이너 실제 크기 확인 후 API 초기화
- 여러 시점에서 리사이즈 이벤트 트리거
- `setTimeout`으로 트랜지션 완료 대기

**참고 문서**: `NAVER_STREETVIEW_FIX_REPORT.md`

### 7.2 미니맵 위치 문제

**문제**: 거리뷰 활성화 시 미니맵이 올바른 위치에 표시되지 않음

**근본 원인**: 맵 API가 스타일을 오버라이드하여 CSS 설정이 무시됨

**해결 방안**:
- 인라인 스타일로 위치 강제 설정
- MutationObserver로 스타일 변경 감지
- 여러 시점에서 위치 재설정

**참고 문서**: `미니맵_위치_문제_해결보고서.md`

### 7.3 지적 경계 폴리곤 문제

**문제**: VWorld API에서 받은 폴리곤 좌표가 올바르게 표시되지 않음

**근본 원인**: 좌표계 불일치 (EPSG:5179 vs EPSG:4326)

**해결 방안**:
- proj4 라이브러리로 좌표계 변환
- 좌표계 자동 감지
- MultiPolygon 지원

**참고 문서**: `지적경계폴리곤_문제분석_및_해결방안.md`

### 7.4 맵 동기화 무한 루프

**문제**: 맵 동기화 시 무한 루프 발생

**해결 방안**:
- `isProgrammaticUpdate` 플래그 사용
- `isDragging` 플래그 사용
- 상태 업데이트 조건부 실행

### 7.5 SDK 로딩 타이밍 문제

**문제**: 여러 맵 SDK 동시 로드로 인한 초기화 실패

**해결 방안**:
- 300ms 간격으로 SDK 로드 상태 확인
- 각 SDK별 초기화 함수 분리
- 로딩 상태 표시

---

## 8. 성능 및 최적화

### 8.1 현재 적용된 최적화

1. **React 메모이제이션**
   - `useCallback`으로 함수 메모이제이션
   - 불필요한 리렌더링 방지

2. **이벤트 리스너 관리**
   - 중복 리스너 방지
   - 리스너 정리 메커니즘

3. **상태 업데이트 최적화**
   - 조건부 업데이트 (`shouldUpdate` 함수)
   - 디바운싱

4. **리소스 재사용**
   - 맵 인스턴스 재사용
   - 오버레이 재사용

### 8.2 성능 메트릭

- **초기 로딩 시간**: SDK 로드 시간에 의존 (약 1-3초)
- **맵 전환 시간**: 약 300ms (트랜지션)
- **검색 응답 시간**: Kakao API 응답 시간에 의존 (약 100-500ms)

### 8.3 향후 최적화 계획

- 코드 스플릿팅
- 이미지 최적화
- 지연 로딩 (Lazy Loading)
- 번들 크기 최소화
- ResizeObserver 활용

---

## 9. 보안 고려사항

### 9.1 현재 적용된 보안

1. **API 키 관리**
   - HTML에 하드코딩 (개선 필요)
   - 환경 변수 지원 (Vite 설정)

2. **입력 검증**
   - 검색 입력 검증
   - 파일 업로드 검증

3. **XSS 방지**
   - React 자동 이스케이핑
   - 커스텀 오버레이 HTML 주의

### 9.2 보안 개선 필요 사항

- API 키 환경 변수로 이동 (프로덕션)
- CSP (Content Security Policy) 설정
- CORS 정책 준수
- 입력값 검증 강화

---

## 10. 개선 사항 및 향후 계획

### 10.1 해결된 이슈

- ✅ Naver 거리뷰 파노라마 렌더링 문제
- ✅ 미니맵 위치 문제
- ✅ 지적 경계 폴리곤 좌표 변환 문제
- ✅ 맵 동기화 무한 루프 문제

### 10.2 향후 개선 예정

#### 단기 계획
- [ ] ResizeObserver를 활용한 더 강건한 컨테이너 크기 감시
- [ ] Google Street View 지원 강화
- [ ] 모바일 반응형 디자인 개선
- [ ] API 키 환경 변수로 이동

#### 중기 계획
- [ ] 측정 결과 내보내기 기능 (JSON/CSV)
- [ ] 지도 기록 저장 및 로드 기능
- [ ] 어두운 테마 지원
- [ ] 다국어 지원

#### 장기 계획
- [ ] 3D 지도 지원
- [ ] 실시간 협업 기능
- [ ] 플러그인 시스템
- [ ] 오프라인 모드 지원

### 10.3 기술 부채

1. **코드 구조**
   - MapPane.tsx가 너무 큼 (2,240줄) → 분리 필요
   - 중복 코드 존재 → 공통 함수 추출

2. **타입 안정성**
   - `any` 타입 사용 (맵 API 타입 정의 부족)
   - 전역 객체 타입 정의 보완 필요

3. **테스트**
   - 단위 테스트 없음
   - 통합 테스트 없음

---

## 11. 결론

### 11.1 프로젝트 성과

Cadapol 프로젝트는 **다중 지도 서비스를 통합한 고급 GIS 웹 애플리케이션**으로, 다음과 같은 성과를 달성했습니다:

1. **기술적 성과**
   - 3개 지도 제공자 통합 (Google, Kakao, Naver)
   - 실시간 동기화 구현
   - 고급 GIS 기능 제공
   - 복잡한 UI/UX 구현

2. **문제 해결 능력**
   - 여러 기술적 도전 과제 해결
   - 상세한 문제 분석 및 해결 보고서 작성
   - 지속적인 개선

3. **코드 품질**
   - TypeScript로 타입 안정성 확보
   - 컴포넌트 기반 아키텍처
   - 재사용 가능한 컴포넌트 구조

### 11.2 주요 강점

- ✅ **다중 지도 서비스 지원**: 하나의 인터페이스에서 여러 지도 비교
- ✅ **실시간 동기화**: 위치, 줌, 거리뷰 상태 동기화
- ✅ **고급 GIS 기능**: 거리/면적 측정, 지적 경계 조회
- ✅ **직관적인 UI**: 사용자 친화적 인터페이스
- ✅ **확장 가능한 구조**: 컴포넌트 기반 아키텍처

### 11.3 개선 필요 사항

- ⚠️ **코드 구조**: MapPane.tsx 분리 필요
- ⚠️ **타입 안정성**: `any` 타입 제거
- ⚠️ **테스트**: 단위/통합 테스트 추가
- ⚠️ **보안**: API 키 환경 변수로 이동
- ⚠️ **성능**: 코드 스플릿팅 및 최적화

### 11.4 프로젝트 평가

**전체 평가**: ⭐⭐⭐⭐ (4/5)

**평가 기준**:
- 기능 완성도: ⭐⭐⭐⭐⭐ (5/5)
- 코드 품질: ⭐⭐⭐ (3/5)
- 사용자 경험: ⭐⭐⭐⭐ (4/5)
- 문서화: ⭐⭐⭐⭐⭐ (5/5)
- 테스트: ⭐ (1/5)

### 11.5 최종 의견

Cadapol은 **기술적으로 우수한 프로젝트**로, 복잡한 GIS 기능을 성공적으로 구현했습니다. 특히 다중 지도 서비스 통합과 실시간 동기화는 인상적입니다. 다만 코드 구조 개선과 테스트 추가가 필요하며, 이러한 개선을 통해 더욱 견고한 프로젝트가 될 수 있을 것입니다.

---

**보고서 작성자**: AI Assistant  
**최종 수정일**: 2026년 1월 18일  
**문서 버전**: 1.0

---

## 부록

### A. 주요 상수

- 미니맵 크기: 240px × 240px
- 검색 기록 최대 개수: 5개
- 검색 제안 최대 개수: 10개
- 트랜지션 시간: 300ms
- SDK 체크 간격: 300ms
- VWorld API 키: `04FADF88-BBB0-3A72-8404-479547569E44`

### B. 참고 문서

- [개발보고서.md](개발보고서.md)
- [2026-01-18-1300_중간보고서.md](2026-01-18-1300_중간보고서.md)
- [NAVER_STREETVIEW_FIX_REPORT.md](NAVER_STREETVIEW_FIX_REPORT.md)
- [미니맵_위치_문제_해결보고서.md](미니맵_위치_문제_해결보고서.md)
- [지적경계폴리곤_문제분석_및_해결방안.md](지적경계폴리곤_문제분석_및_해결방안.md)

### C. 관련 링크

- 배포 URL: https://cadapol.vercel.app/
- AI Studio: https://ai.studio/apps/drive/1KP38qyNiBAnnr41-DZJ55VMftVQ7fj1L
